<h1>A Guide to Setting up OpenAFS with Kerberos on Debian for The University of Michigan</h1>
<h2>Introduction</h2>
<h3>What is AFS</h3>
<p>Andrew File System (AFS) is the name of a program written by Transarc Corporation which was acquired by IBM. It implements a distribued filesystem, meaning a filesystem that is distributed across many computers. IBM made a copy of the program's code available for open development and this release is called OpenAFS.</p>
<p>U-M uses OpenAFS to store the files in your CAEN home directory. You can verify this by ssh-ing into a CAEN machine and finding the directory /afs/umich.edu/user/j/m/jminjie/ and comparing its conents to ~/. When OpenAFS is installed, the program abstracts away the actual distributing work being done and mounts the file system in /afs so that your files can be read as if they were on disk. Then login.engin.umich.edu pretends that the /afs directory belonging to your uniqname is your home directory.</p>
<h3>Why use AFS</h3>
<p>For most of my U-M EECS undergraduate career my workflow consisted of editing files on my computer using my preferred text editors, transferring the files to my CAEN home directory using WinSCP or git, and compiling on CAEN.</p>
<p>With this guide you will be able to edit files as if they were on your own disk and your changes will propogate so that anyone using OpenAFS to view them will see the changes. That means the new workflow consists of just editing and then compiling on CAEN.</p>
<h3>What is Kerberos</h3>
<p>OpenAFS uses Kerberos for authentication. Just like when you log in to Wolverine Access, CTools or Canvas, the authentication token you receive is good for a whole bunch of different U-M services. We need to use Kerberos together with OpenAFS because we don't own the filesystem at umich.edu, the school does.</p>
<h2>Setting up Kerberos</h2>
<body>
I explain how to set up the Kerberos part.
<pre><code>
sudo apt-get install krb5-user
scp jminjie@login.engin.umich.edu:/etc/krb5.conf temp.txt
sudo mv temp.txt /etc/krb5.conf
kinit jminjie@UMICH.EDU
klist
</code></pre>
</body>
<h2>Setting up AFS</h2>
<body>
I explain how to set up the AFS part.
<pre><code>
sudo apt-get install openafs-client openafs-krb5 openafs-modules-dkms
sudo dpkg-reconfigure krb5-config openafs-client
</code></pre>
Running dpkg-reconfigure will open a window in which you should choose these options:
<pre>
Default realm:	                                             UMICH.EDU
Does DNS contain pointers to your realm's Kerberos Servers?  Yes
AFS cell this workstation belongs to:                        umich.edu
Size of AFS cache:                                           512000 (this means 0.5GB, and can be higher if you have the space. All students at U-M get 10GB max.)
Run openafs client now and at boot?                          (user preference)
Look up AFS cells in DNS?                                    Yes
Encrypt authenticated traffic with AFS fileserver?           Yes
Dynamically generate the contents of /afs                    Yes
Use fakestat?                                                Yes
DB server host names for your home cell:                     (blank)
Run openafs client now and at boot?                          (user preference)
</pre>
<pre><code>
sudo service openafs-client restart
scp jminjie@login.engin.umich.edu:/etc/openafs/CellServDB temp.txt
sudo mv temp.txt /etc/openafs/CellServDB
aklog
tokens
</code></pre>
</body>
<h2>Putting it all together</h2>
<body>
I explain how to put it all together
<pre><code>
$ chmod +x init_afs
$ cat init_afs
#!/bin/sh
kinit jminjie@UMICH.EDU
klist
aklog
tokens
cd  /afs/umich.edu/user/j/m/jminjie
</code></pre>
I made a shell script called init_afs. You could run it using <code>./init_afs</code> but since this would open up a temporary shell and execute it, and I want the script to change my directory, I invoke it with <code>source init_afs</code> instead.
</body>
<h2>Resources</h2>
<body>
These are the resources I used:<br>
http://csw.github.io/bioruby-maf/blog/2012/09/26/ssh_kerberos_umich/<br>
http://tig.csail.mit.edu/wiki/TIG/OpenAFSOnUbuntuLinux<br>
</body>
